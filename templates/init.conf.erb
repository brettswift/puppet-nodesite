#!upstart
description "node.js server"
author      "brett"

start on startup
stop on shutdown
# PID_FILE=/var/run/<%=@project_name%>.pid
expect fork

respawn

script
    export HOME="/root"
	export NODE_EXEC="<%= scope.lookupvar('nvm_nodejs::NODE_EXEC') %>"
	export APP_DIR='<%=@nodesite_dir%>/<%=@project_name%>'
	export NODE_ENV=production 
    export NODE_CONFIG_DIR=$APP_DIR/config
    
    echo $$ > /var/run/<%=@project_name%>.pid
    exec $NODE_EXEC $APP_DIR/<%=@file_to_run%> >> /var/log/<%=@project_name%>.sys.log 2>&1
    # exec sudo -u username /usr/local/bin/node /where/<%=@file_to_run%>.js >> /var/log/<%=@project_name%>.sys.log 2>&1
end script

pre-start script
    # Date format same as (new Date()).toISOString() for consistency
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Starting" >> /var/log/<%=@project_name%>.sys.log
end script

pre-stop script
    rm /var/run/<%=@project_name%>.pid
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Stopping" >> /var/log/<%=@project_name%>.sys.log
end script